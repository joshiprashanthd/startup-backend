(()=>{"use strict";var e={5232:function(e,t,n){var o,r,i,u=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&u(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),a(n(334)).config(),t.default={gmailUser:null!==(o=process.env.GMAIL_USER)&&void 0!==o?o:"",gmailPassword:null!==(r=process.env.GMAIL_PASSWORD)&&void 0!==r?r:"",gmailSender:null!==(i=process.env.GMAIL_SENDER)&&void 0!==i?i:"prashantjoshi@collabs.com"}},2275:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NodeConfig=t.GmailConfig=t.TokenConfig=t.MongoConfig=t.SessionConfig=void 0;var r=n(9696);Object.defineProperty(t,"SessionConfig",{enumerable:!0,get:function(){return o(r).default}});var i=n(5466);Object.defineProperty(t,"MongoConfig",{enumerable:!0,get:function(){return o(i).default}});var u=n(5736);Object.defineProperty(t,"TokenConfig",{enumerable:!0,get:function(){return o(u).default}});var s=n(5232);Object.defineProperty(t,"GmailConfig",{enumerable:!0,get:function(){return o(s).default}});var a=n(7173);Object.defineProperty(t,"NodeConfig",{enumerable:!0,get:function(){return o(a).default}})},5466:function(e,t,n){var o,r,i,u=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&u(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),a(n(334)).config(),t.default={mongoUserName:null!==(o=process.env.MONGO_USER)&&void 0!==o?o:"",mongoUserPassword:null!==(r=process.env.MONGO_PASSWORD)&&void 0!==r?r:"",mongoDatabaseName:null!==(i=process.env.MONGO_DATABASE)&&void 0!==i?i:""}},7173:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),i(n(334)).config(),t.default={nodeEnvironment:null!=="production"?"production":"development"}},9696:function(e,t,n){var o,r,i,u=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&u(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),a(n(334)).config(),t.default={sessionName:null!==(o=process.env.SESSION_NAME)&&void 0!==o?o:"",sessionLifetime:null!==(r=process.env.SESSION_LIFETIME)&&void 0!==r?r:"1800000",sessionSecret:null!==(i=process.env.SESSION_SECRET)&&void 0!==i?i:"secret"}},5736:function(e,t,n){var o,r,i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return u(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),s(n(334)).config(),t.default={tokenSecret:null!==(o=process.env.TOKEN_SECRET)&&void 0!==o?o:"pokjnlakjdshq",tokenExpiry:null!==(r=process.env.TOKEN_EXPIRY)&&void 0!==r?r:43200..toString()}},3396:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(5619)),u=n(2275);t.default=function(){return o(this,void 0,void 0,(function*(){let e=!1;try{yield i.default.connect(`mongodb+srv://${u.MongoConfig.mongoUserName}:${u.MongoConfig.mongoUserPassword}@cluster0.vuqtk.mongodb.net/${u.MongoConfig.mongoDatabaseName}?retryWrites=true&w=majority`,{useUnifiedTopology:!0,useNewUrlParser:!0,useFindAndModify:!1})}catch(t){e=!0}finally{e?console.log("[MONGOOSE] error connecting to MongoDB"):console.log("[SERVER] connected to database")}}))}},4769:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(8712)),u=r(n(5619)),s=n(5439);function a(e){return o(this,void 0,void 0,(function*(){const t=u.default.model("Conversation"),n=yield t.find({_id:{$in:e}}),o=s.groupBy((e=>e.id),n);return s.map((e=>o[e][0]),e)}))}t.default=()=>new i.default(a)},985:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(1107)),i=o(n(4365)),u=o(n(3721)),s=o(n(4769));t.default={userLoader:r.default(),skillLoader:i.default(),messageLoader:u.default(),conversationLoader:s.default()}},3721:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(8712)),u=r(n(5619)),s=n(5439);function a(e){return o(this,void 0,void 0,(function*(){const t=u.default.model("Message"),n=yield t.find({_id:{$in:e}}),o=s.groupBy((e=>e.id),n);return s.map((e=>o[e][0]),e)}))}t.default=()=>new i.default(a)},4365:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(8712)),u=r(n(5619)),s=n(5439);function a(e){return o(this,void 0,void 0,(function*(){const t=u.default.model("Skill"),n=yield t.find({_id:{$in:e}}),o=s.groupBy((e=>e.id),n);return s.map((e=>o[e][0]),e)}))}t.default=()=>new i.default(a)},1107:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(8712)),u=r(n(5619)),s=n(5439);function a(e){return o(this,void 0,void 0,(function*(){const t=u.default.model("User"),n=yield t.find({_id:{$in:e}}),o=s.groupBy((e=>e.id),n);return s.map((e=>o[e][0]),e)}))}t.default=()=>new i.default(a)},6199:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationResolvers=t.ConversationTypeDef=void 0;var r=n(2642);Object.defineProperty(t,"ConversationTypeDef",{enumerable:!0,get:function(){return o(r).default}});var i=n(1204);Object.defineProperty(t,"ConversationResolvers",{enumerable:!0,get:function(){return o(i).default}})},1667:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapConversations=t.mapConversation=void 0;const o=n(1639),r=n(6313);t.mapConversation=(e,t)=>({id:e.id,conversers:r.mapUserIds(e.conversers.map((e=>e.toString())),t),messages:o.mapMessageIds(e.messages.map((e=>e.toString())),t),createdAt:e.createdAt,updatedAt:e.updatedAt}),t.mapConversations=(e,n)=>e.map((e=>t.mapConversation(e,n)))},9643:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Conversation=void 0;var r=n(5823);Object.defineProperty(t,"Conversation",{enumerable:!0,get:function(){return o(r).default}})},5823:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=r.default.Schema,u=new i({conversers:[{type:i.Types.ObjectId,ref:"User"}],messages:[{type:i.Types.ObjectId,ref:"Message"}]},{timestamps:!0});t.default=r.default.model("Conversation",u)},1204:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(742));t.default=Object.assign({},r.default)},742:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1667),i=n(9643);t.default={Query:{conversationsByUser:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){})),conversations:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return(yield i.Conversation.find({})).map((e=>r.mapConversation(e,n)))}))}}},2642:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	extend type Query {
		conversations: [Conversation!]
		conversationsByUser(converserId: ID!): [Conversation!]
	}

	type Conversation {
		id: ID!
		conversers: [User!]
		messages(cursor: ID, limit: Int = 50): [Message!]
		createdAt: Date!
		updatedAt: Date!
	}
`},4664:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8262),i=n(9313),u=n(866);class s extends r.SchemaDirectiveVisitor{visitFieldDefinition(e){const{resolve:t=i.defaultFieldResolver}=e;e.resolve=function(...e){return o(this,void 0,void 0,(function*(){const[n,o,r]=e;return u.ensureSignedIn(r),t.apply(this,e)}))}}}t.default=s},3506:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8262),i=n(9313),u=n(866);class s extends r.SchemaDirectiveVisitor{visitFieldDefinition(e){const{resolve:t=i.defaultFieldResolver}=e;e.resolve=function(...e){return o(this,void 0,void 0,(function*(){const[n,o,r]=e;return u.ensureSignedOut(r),t.apply(this,e)}))}}}t.default=s},115:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PrivateDirective=t.GuestDirective=t.AuthDirective=void 0;var r=n(4664);Object.defineProperty(t,"AuthDirective",{enumerable:!0,get:function(){return o(r).default}});var i=n(3506);Object.defineProperty(t,"GuestDirective",{enumerable:!0,get:function(){return o(i).default}});var u=n(3095);Object.defineProperty(t,"PrivateDirective",{enumerable:!0,get:function(){return o(u).default}})},3095:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8262),i=n(9313);class u extends r.SchemaDirectiveVisitor{visitFieldDefinition(e){const{resolve:t=i.defaultFieldResolver}=e;e.resolve=function(...n){return o(this,void 0,void 0,(function*(){const[o,r,i,u]=n;return o.id===i.req.session.userId&&"userId"in i.req.session||(o[e.name]=null),t.apply(this,[o,r,i,u])}))}}}t.default=u},3180:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DirectivesTypeDef=void 0;const r=n(115);var i=n(8542);Object.defineProperty(t,"DirectivesTypeDef",{enumerable:!0,get:function(){return o(i).default}}),t.default={auth:r.AuthDirective,guest:r.GuestDirective,private:r.PrivateDirective}},8542:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	directive @guest on FIELD_DEFINITION
	directive @auth on FIELD_DEFINITION
	directive @private on FIELD_DEFINITION
`},5116:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomScalarResolvers=t.CustomScalarTypeDef=void 0;var r=n(5346);Object.defineProperty(t,"CustomScalarTypeDef",{enumerable:!0,get:function(){return o(r).default}});var i=n(3277);Object.defineProperty(t,"CustomScalarResolvers",{enumerable:!0,get:function(){return o(i).default}})},8822:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(9313),r=n(7772);t.default={Date:new o.GraphQLScalarType({name:"Date",description:"Date custom scalar type",parseValue:e=>new Date(e),serialize:e=>e.getTime(),parseLiteral:e=>e.kind===r.Kind.INT?parseInt(e.value,10):null})}},3277:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(8822));t.default=Object.assign({},r.default)},5346:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	scalar Date
`},25:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvers=t.TypeDefs=void 0;var r=n(5775);Object.defineProperty(t,"TypeDefs",{enumerable:!0,get:function(){return o(r).default}});var i=n(3465);Object.defineProperty(t,"Resolvers",{enumerable:!0,get:function(){return o(i).default}})},4643:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageResolvers=t.MessageTypeDef=void 0;var r=n(5122);Object.defineProperty(t,"MessageTypeDef",{enumerable:!0,get:function(){return o(r).default}});var i=n(5737);Object.defineProperty(t,"MessageResolvers",{enumerable:!0,get:function(){return o(i).default}})},1639:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mapMessageIds=t.mapMessage=void 0;const r=n(6313);t.mapMessage=(e,t)=>({id:e.id,body:e.body,read:e.read,createdAt:e.createdAt,updatedAt:e.updatedAt,sender:r.mapUserId(e.sender.toString(),t),receiver:r.mapUserId(e.receiver.toString(),t)}),t.mapMessageIds=(e,n)=>()=>o(void 0,void 0,void 0,(function*(){return(yield n.dataloaders.messageLoader.loadMany(e)).map((e=>t.mapMessage(e,n)))}))},1745:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;var r=n(5533);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return o(r).default}})},5533:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=r.default.Schema,u=new i({sender:{type:i.Types.ObjectId,ref:"User"},receiver:{type:i.Types.ObjectId,ref:"User"},body:{type:String,required:!0},read:{type:Boolean,required:!0,default:!1}},{timestamps:!0});t.default=r.default.model("Message",u)},5737:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(4263)),i=o(n(7801));t.default=Object.assign(Object.assign({},r.default),i.default)},7801:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(9643),i=n(3766),u=n(1639),s=n(1745);t.default={Mutation:{createMessage:(e,t,n,a)=>o(void 0,void 0,void 0,(function*(){const e=yield s.Message.create({sender:t.input.senderId,receiver:t.input.receiverId,body:t.input.body}),o=yield r.Conversation.findOne({conversers:{$all:[t.input.senderId,t.input.receiverId]}});if(!o){const o=yield r.Conversation.create({conversers:[t.input.senderId,t.input.receiverId]});return yield o.updateOne({messages:[e.id]}),yield i.User.findByIdAndUpdate(t.input.senderId,{$push:{conversations:o.id}}),yield i.User.findByIdAndUpdate(t.input.receiverId,{$push:{conversations:o.id}}),u.mapMessage(e,n)}return yield o.updateOne({$push:{messages:{$each:[e.id],$position:0}}}),u.mapMessage(e,n)})),editMessage:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){const e=yield s.Message.findByIdAndUpdate(t.messageId,{body:t.body},{new:!0});return u.mapMessage(e,n)})),removeMessage:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){return!!(yield s.Message.findByIdAndDelete(t.messageId))}))}}},4263:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1639),i=n(1745);t.default={Query:{messages:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return(yield i.Message.find({})).map((e=>r.mapMessage(e,n)))}))}}},5122:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	input StrictMessageInput {
		senderId: ID!
		receiverId: ID!
		body: String!
	}

	extend type Query {
		messages: [Message!]
	}

	extend type Mutation {
		createMessage(input: StrictMessageInput!): Message!
		removeMessage(messageId: ID!): Boolean!
		editMessage(body: String!, messageId: ID!): Message!
	}

	type Message {
		id: ID!
		sender: User!
		receiver: User!
		body: String!
		read: Boolean!
		createdAt: Date!
		updatedAt: Date!
	}
`},7137:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectRequestTypeDef=t.ProjectRequestResolvers=void 0;var r=n(7374);Object.defineProperty(t,"ProjectRequestResolvers",{enumerable:!0,get:function(){return o(r).default}});var i=n(8555);Object.defineProperty(t,"ProjectRequestTypeDef",{enumerable:!0,get:function(){return o(i).default}})},8905:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mapProjectRequest=void 0;const r=n(7247),i=n(6313);t.mapProjectRequest=(e,t)=>({id:e.id,from:i.mapUserId(e.from,t),to:()=>o(void 0,void 0,void 0,(function*(){return r.Project.findById(e.to)})),message:e.message,status:e.status,createdAt:e.createdAt,updatedAt:e.updatedAt})},8158:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectRequest=void 0;var r=n(2906);Object.defineProperty(t,"ProjectRequest",{enumerable:!0,get:function(){return o(r).default}})},2906:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=r.default.Schema,u=new i({from:{type:i.Types.ObjectId,ref:"User"},to:{type:i.Types.ObjectId,ref:"Project"},message:String,status:{type:String,enum:["PENDING","ACCEPTED","DENIED"],required:!0,default:"PENDING"}},{timestamps:!0});t.default=r.default.model("ProjectRequest",u)},6185:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectRequestStatusEnum=void 0,(n=t.ProjectRequestStatusEnum||(t.ProjectRequestStatusEnum={})).PENDING="PENDING",n.ACCEPTED="ACCEPTED",n.DENIED="DENIED"},7374:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(6482)),i=o(n(1120));t.default=Object.assign(Object.assign({},i.default),r.default)},1120:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8262),i=n(7247),u=n(8905),s=n(8158),a=n(6185);t.default={Mutation:{toggleRequestProject:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){const e=yield s.ProjectRequest.findOne({from:n.req.session.userId,to:t.projectId});if(e)return yield e.deleteOne(((e,t)=>{if(e)throw new r.ApolloError(e)})),!1;if((yield i.Project.findById(t.projectId)).details.creator.toString()===n.req.session.userId.toString())throw new r.ApolloError("You cannot request your own project.");return yield s.ProjectRequest.create({from:n.req.session.userId,to:t.projectId,status:a.ProjectRequestStatusEnum.PENDING,message:0===t.message.length?null:t.message}),!0})),acceptProjectRequest:(e,t,n,d)=>o(void 0,void 0,void 0,(function*(){const e=yield s.ProjectRequest.findById(t.projectRequestId),o=yield i.Project.findById(e.to);if(o.details.creator.toString()!==n.req.session.userId.toString())throw new r.AuthenticationError("Your are not allowed to accept this request.");if(e.status===a.ProjectRequestStatusEnum.ACCEPTED)throw new r.ApolloError("Request is already accepted.");const d=yield s.ProjectRequest.findByIdAndUpdate(e.id,{status:a.ProjectRequestStatusEnum.ACCEPTED},{new:!0});return yield o.updateOne({$push:{"work.team":d.from}}),u.mapProjectRequest(d,n)}))}}},6482:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8905),i=n(8158);t.default={Query:{projectRequests:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return(yield i.ProjectRequest.find({})).map((e=>r.mapProjectRequest(e,n)))}))}}},8555:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	enum RequestStatusEnum {
		PENDING
		ACCEPTED
		DENIED
	}

	type ProjectRequest {
		id: ID!
		from: User!
		to: Project!
		message: String
		status: RequestStatusEnum!
		createdAt: Date!
		updatedAt: Date!
	}

	extend type Query {
		projectRequests: [ProjectRequest!]
	}

	extend type Mutation {
		toggleRequestProject(message: String!, projectId: ID!): Boolean! @auth
		acceptProjectRequest(projectRequestId: ID!): ProjectRequest! @auth
	}
`},2103:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectTypeDef=t.ProjectResolvers=void 0;var r=n(7034);Object.defineProperty(t,"ProjectResolvers",{enumerable:!0,get:function(){return o(r).default}});var i=n(1679);Object.defineProperty(t,"ProjectTypeDef",{enumerable:!0,get:function(){return o(i).default}})},67:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mapProject=void 0;const r=n(8905),i=n(8158),u=n(5431),s=n(6313);t.mapProject=(e,t)=>({id:e.id,details:Object.assign(Object.assign({},e.details),{skillSet:u.mapSkillIds(e.details.skillSet,t),creator:s.mapUserId(e.details.creator,t),stars:s.mapUserIds(e.details.stars,t),requests:()=>o(void 0,void 0,void 0,(function*(){return(yield i.ProjectRequest.find({to:e.id})).map((e=>r.mapProjectRequest(e,t)))}))}),isStarred:e.details.stars.includes(t.req.session.userId),isRequested:()=>o(void 0,void 0,void 0,(function*(){return null!==(yield i.ProjectRequest.findOne({from:t.req.session.userId,to:e.id}))})),state:e.state,work:{team:s.mapUserIds(e.work.team,t)},createdAt:e.createdAt,updatedAt:e.updatedAt})},7247:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Project=void 0;var r=n(4560);Object.defineProperty(t,"Project",{enumerable:!0,get:function(){return o(r).default}})},4560:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=r.default.Schema,u=new i({details:{title:{type:String,required:!0},description:{type:String,required:!0},startingOn:{type:Date,required:!0},duration:{type:Number,required:!0},maxTeamMembers:{type:Number,required:!0},creator:{type:i.Types.ObjectId,ref:"User"},skillSet:[{type:i.Types.ObjectId,ref:"Skill"}],stars:[{type:i.Types.ObjectId,ref:"User"}]},work:{team:[{type:i.Types.ObjectId,ref:"User"}]},state:{type:String,enum:["OPEN","CLOSED","STARTED","ENDED"],default:"OPEN"}},{timestamps:!0});t.default=r.default.model("Project",u)},7034:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(8930)),i=o(n(7773));t.default=Object.assign(Object.assign({},i.default),r.default)},7773:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8262),i=n(67),u=n(7247);t.default={Mutation:{createProject:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){const e=t.input.details.skillSet,o={details:Object.assign(Object.assign({},t.input.details),{skillSet:e.map((e=>e.skillId)),creator:n.req.session.userId})},r=yield u.Project.create(o);return i.mapProject(r,n)})),editProject:(e,t,n,s)=>o(void 0,void 0,void 0,(function*(){const e=yield u.Project.findById(t.input.projectId);if(!e)throw new r.ApolloError("Project not found.");if(e.details.creator.toString()!==n.req.session.userId.toString())throw new r.ApolloError("You cannot edit this project.");let o=e.details.skillSet;"skillSet"in t.input.details&&(o=t.input.details.skillSet.map((e=>e.skillId)));const s={details:"details"in t.input?Object.assign(Object.assign(Object.assign({},e.toObject().details),t.input.details),{skillSet:o}):e.toObject().details};return yield e.updateOne(s,((e,t)=>{if(e)throw new r.ApolloError(e)})),i.mapProject(Object.assign(e,s),n)})),toggleStarProject:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){const e=yield u.Project.findById(t.projectId),o=e.details.stars.includes(n.req.session.userId);return o?yield e.updateOne({$pull:{"details.stars":n.req.session.userId}}):yield e.updateOne({$push:{"details.stars":n.req.session.userId}}),!o}))}}},8930:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3766),i=n(67),u=n(7247);t.default={Query:{projects:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){return(yield u.Project.find({})).map((e=>i.mapProject(e,n)))})),projectsByUserInterests:(e,t,n,s)=>o(void 0,void 0,void 0,(function*(){const e=(yield r.User.findById(t.userId)).personalInfo.interests;return console.log(e),(yield u.Project.find({"details.skillSet":{$in:e}})).map((e=>i.mapProject(e,n)))})),projectById:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){return i.mapProject(yield u.Project.findById(t.projectId),n)}))}}},1679:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	input StrictProjectDetailsInput {
		title: String!
		description: String!
		startingOn: Date!
		maxTeamMembers: Int!
		duration: Int!
		skillSet: [SkillIdInput!]
	}

	input StrictProjectInput {
		details: StrictProjectDetailsInput!
	}

	input LooseProjectDetailsInput {
		title: String
		description: String
		startingOn: Date
		maxTeamMembers: Int
		duration: Int
		skillSet: [SkillIdInput!]
	}

	input LooseProjectInput {
		projectId: ID!
		details: LooseProjectDetailsInput
	}

	enum ProjectStateEnum {
		OPEN
		CLOSED
		STARTED
		ENDED
	}

	type ProjectDetails {
		title: String!
		description: String!
		startingOn: Date!
		maxTeamMembers: Int!
		duration: Int!
		creator: User!
		skillSet: [Skill!]
		stars: [User!]
		requests: [ProjectRequest!]
	}

	type ProjectWork {
		team: [User!]
	}

	type Project {
		id: ID!
		details: ProjectDetails!
		state: ProjectStateEnum!
		work: ProjectWork!
		isStarred: Boolean!
		isRequested: Boolean!
		createdAt: Date!
		updatedAt: Date!
	}

	extend type Query {
		projects: [Project!]
		projectsByUserInterests(userId: ID!): [Project!]
		projectById(projectId: ID!): Project!
	}

	extend type Mutation {
		createProject(input: StrictProjectInput!): Project! @auth
		editProject(input: LooseProjectInput!): Project! @auth
		toggleStarProject(projectId: ID!): Boolean! @auth
	}
`},3465:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8323),r=n(7129),i=n(4643),u=n(2103),s=n(7137),a=n(6199),d=n(5116);t.default=[o.UserResolvers,r.SkillResolvers,d.CustomScalarResolvers,i.MessageResolvers,u.ProjectResolvers,s.ProjectRequestResolvers,a.ConversationResolvers]},616:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootTypeDef=void 0;var r=n(5939);Object.defineProperty(t,"RootTypeDef",{enumerable:!0,get:function(){return o(r).default}})},5939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	type Query {
		_: String
	}

	type Mutation {
		_: String
	}

	type Subscription {
		_: String
	}
`},7129:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SkillTypeDef=t.SkillResolvers=void 0;var r=n(6259);Object.defineProperty(t,"SkillResolvers",{enumerable:!0,get:function(){return o(r).default}});var i=n(1037);Object.defineProperty(t,"SkillTypeDef",{enumerable:!0,get:function(){return o(i).default}})},5431:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mapSkillIds=t.mapSkill=void 0,t.mapSkill=e=>({id:e.id,name:e.name,color:e.color,description:e.description}),t.mapSkillIds=(e,o)=>()=>n(void 0,void 0,void 0,(function*(){return(yield o.dataloaders.skillLoader.loadMany(e)).map((e=>t.mapSkill(e)))}))},1001:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Skill=void 0;var r=n(8645);Object.defineProperty(t,"Skill",{enumerable:!0,get:function(){return o(r).default}})},8645:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=new(0,r.default.Schema)({name:{type:String,required:!0},description:{type:String,required:!0},color:{type:String,required:!0}});t.default=r.default.model("Skill",i)},6259:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(8478)),i=o(n(85));t.default=Object.assign(Object.assign({},r.default),i.default)},85:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(1001);t.default={Mutation:{createSkill:(e,t,n,r)=>o.Skill.create(t.input)}}},8478:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5431),i=n(1001);t.default={Query:{skills:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return(yield i.Skill.find({})).map((e=>r.mapSkill(e)))}))}}},1037:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	input SkillIdInput {
		skillId: ID!
	}

	input StrictSkillInput {
		name: String!
		description: String!
		color: String!
	}

	input LooseSkillInput {
		name: String
		description: String
		color: String
	}

	extend type Query {
		skills: [Skill!]
	}

	extend type Mutation {
		createSkill(input: StrictSkillInput!): Skill! @auth
	}

	type Skill {
		id: ID!
		name: String!
		description: String!
		color: String!
	}
`},5775:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(616),r=n(8323),i=n(6199),u=n(4643),s=n(7129),a=n(2103),d=n(7137),c=n(5116),l=n(3180);t.default=[c.CustomScalarTypeDef,l.DirectivesTypeDef,o.RootTypeDef,r.UserTypeDef,s.SkillTypeDef,u.MessageTypeDef,a.ProjectTypeDef,d.ProjectRequestTypeDef,i.ConversationTypeDef]},8323:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserTypeDef=t.UserResolvers=void 0;var r=n(6810);Object.defineProperty(t,"UserResolvers",{enumerable:!0,get:function(){return o(r).default}});var i=n(857);Object.defineProperty(t,"UserTypeDef",{enumerable:!0,get:function(){return o(i).default}})},6313:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.mapUserIds=t.mapUserId=t.mapUser=void 0;const r=n(5431);t.mapUser=(e,t)=>({id:e.id,accountInfo:Object.assign({},e.accountInfo),personalInfo:Object.assign(Object.assign({},e.personalInfo),{interests:r.mapSkillIds(e.personalInfo.interests,t)}),statusInfo:e.statusInfo}),t.mapUserId=(e,n)=>()=>o(void 0,void 0,void 0,(function*(){return t.mapUser(yield n.dataloaders.userLoader.load(e),n)})),t.mapUserIds=(e,n)=>()=>o(void 0,void 0,void 0,(function*(){return(yield n.dataloaders.userLoader.loadMany(e)).map((e=>t.mapUser(e,n)))}))},3766:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var r=n(8036);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return o(r).default}})},8036:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(5619)),u=n(6552),s=i.default.Schema,a=new s({accountInfo:{email:{type:String,required:!0},password:{type:String,required:!0},name:{type:String,required:!0},handler:{type:String,required:!0},verifiedEmail:{type:Boolean,default:!1}},personalInfo:{bio:{type:String,default:null},birthDate:{type:Date,default:null},interests:[{type:s.Types.ObjectId,ref:"Skill"}]},statusInfo:{isOnline:{type:Boolean,required:!0,default:!1},lastActive:{type:Date,default:null}},conversations:[{type:s.Types.ObjectId,ref:"Conversation"}]},{timestamps:!0,versionKey:"schemaVersion"});a.pre("save",(function(){return o(this,void 0,void 0,(function*(){this.isModified("accountInfo.password")&&(this.accountInfo.password=yield u.hash(this.accountInfo.password,12))}))})),a.methods.comparePassword=function(e){return u.compare(e,this.accountInfo.password)},a.path("accountInfo.handler").validate((function(e){return o(this,void 0,void 0,(function*(){const t=i.default.model("User");return null===(yield t.findOne({"accountInfo.handler":e}))}))}),"Handler `{VALUE}` already exist"),a.path("accountInfo.email").validate((function(e){return o(this,void 0,void 0,(function*(){const t=i.default.model("User");return null===(yield t.findOne({"accountInfo.email":e}))}))}),"Email `{VALUE}` already registered."),t.default=i.default.model("User",a)},6810:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(2888)),i=o(n(4843)),u=o(n(4746));t.default=Object.assign(Object.assign(Object.assign({},r.default),i.default),u.default)},4843:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8262),u=r(n(9722)),s=n(3766),a=n(866),d=n(6313),c=n(8151),l=n(2275);t.default={Mutation:{createUser:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){const e=yield s.User.create(t.input),o=u.default.sign({userId:e.id,email:e.accountInfo.email},l.TokenConfig.tokenSecret,{expiresIn:parseInt(l.TokenConfig.tokenExpiry)});return c.sendVerificationEmail(e,o),d.mapUser(e,n)})),editUser:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){const e=yield s.User.findById(t.input.userId);if(!e)throw new i.ApolloError("User not found.");delete t.input.userId;const o={accountInfo:"accountInfo"in t.input?Object.assign(Object.assign({},e.toObject().accountInfo),t.input.accountInfo):e.toObject().accountInfo,personalInfo:"personalInfo"in t.input?Object.assign(Object.assign({},t.input.personalInfo),{interests:"interests"in t.input.personalInfo?t.input.personalInfo.interests.map((e=>e.skillId)):e.personalInfo.interests}):e.toObject().personalInfo};return yield e.updateOne(o,((e,t)=>{if(e)throw new i.ApolloError(e)})),d.mapUser(Object.assign(e,o),n)})),signIn:(e,{email:t,password:n},r,i)=>o(void 0,void 0,void 0,(function*(){return d.mapUser(yield a.attemptSignIn(t,n,r),r)})),signOut:(e,t,n,r)=>o(void 0,void 0,void 0,(function*(){return yield s.User.findByIdAndUpdate(n.req.session.userId,{"statusInfo.lastActive":(new Date).getTime()}),a.attemptSignOut(n)}))}}},2888:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3766),i=n(6313);t.default={Query:{users:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return(yield r.User.find({})).map((e=>i.mapUser(e,n)))})),me:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return i.mapUser(yield r.User.findById(n.req.session.userId),n)})),user:(e,t,n,u)=>o(void 0,void 0,void 0,(function*(){return i.mapUser(yield r.User.findById(t.userId),n)}))}}},4746:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={Subscription:{}}},857:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(8262);t.default=o.gql`
	input StrictUserAccountInfoInput {
		email: String!
		password: String!
		handler: String!
		name: String!
	}

	input StrictUserInput {
		accountInfo: StrictUserAccountInfoInput!
	}

	input LooseUserPersonalInfoInput {
		bio: String
		birthDate: Date
		interests: [SkillIdInput!]
	}

	input LooseUserAccountInfoInput {
		email: String
		password: String
		handler: String
		name: String
	}

	input LooseUserInput {
		userId: ID!
		accountInfo: LooseUserAccountInfoInput
		personalInfo: LooseUserPersonalInfoInput
	}

	extend type Query {
		users: [User!]
		user(userId: ID!): User!
		me: User! @auth
	}

	extend type Mutation {
		createUser(input: StrictUserInput!): User! @guest
		editUser(input: LooseUserInput!): User! @auth
		signIn(email: String!, password: String!): User! @guest
		signOut: Boolean! @auth
	}

	type UserAccountInfo {
		name: String!
		email: String
		password: String
		handler: String!
		verifiedEmail: Boolean!
	}

	type UserPersonalInfo {
		bio: String
		birthDate: Date
		interests: [Skill!]
	}

	type UserStatusInfo {
		isOnline: Boolean!
		lastActive: Date
	}

	type User {
		id: ID!
		accountInfo: UserAccountInfo!
		personalInfo: UserPersonalInfo!
		statusInfo: UserStatusInfo!
		conversations: [Conversation!]
	}
`},5299:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(8123)),i=n(2275);t.default=r.default.createTransport({service:"gmail",sender:i.GmailConfig.gmailSender,auth:{user:i.GmailConfig.gmailUser,pass:i.GmailConfig.gmailPassword}})},866:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.attemptSignOut=t.attemptSignIn=t.ensureSignedOut=t.ensureSignedIn=void 0;const r=n(8262),i=n(3766),u=n(2275);t.ensureSignedIn=e=>{if(!e.req.session.userId)throw new r.AuthenticationError("You must be signed in.")},t.ensureSignedOut=e=>{if(e.req.session.userId)throw new r.AuthenticationError("You must be signed out.")},t.attemptSignIn=(e,t,n)=>o(void 0,void 0,void 0,(function*(){const o=yield i.User.findOne({"accountInfo.email":e});if(!o)throw new r.AuthenticationError("Incorrect password or email. Please try again");if(!(yield o.comparePassword(t)))throw new r.AuthenticationError("Incorrect password or email. Please try again.");const u=yield i.User.findByIdAndUpdate(o.id,{isOnline:!0},((e,t)=>{if(e)throw new r.ApolloError(e)}));return n.req.session.userId=o.id,u})),t.attemptSignOut=e=>new Promise(((t,n)=>{i.User.updateOne({_id:e.req.session.userId},{isOnline:!1},((e,t)=>{e&&n(e)})),e.req.session.destroy((o=>{o&&n(o),e.res.clearCookie(u.SessionConfig.sessionName),t(!0)}))}))},8151:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendVerificationEmail=void 0;const r=o(n(5299));t.sendVerificationEmail=(e,t)=>(r.default.sendMail({from:'"Prashant Joshi (CEO)" <no-reply@collabs.com>',to:""+e.accountInfo.email,subject:"Please verify your email address",html:`\n\t\t<html>\n\t\t<head>\n\t\t\t<style>\n\t\t\t\t* {\n\t\t\t\t\tfont-family: "Proxima Nova";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdiv.main {\n\t\t\t\t\twidth: fit-content;\n\t\t\t\t\tmargin: 2rem auto;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tp {\n\t\t\t\t\tfont-size: 1rem;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ta {\n\t\t\t\t\tmargin: 1rem auto;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\tpadding: 1rem;\n\t\t\t\t\ttext-decoration: none;\n\t\t\t\t\tborder-radius: 4pt;\n\t\t\t\t\tbackground-color: blue;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tcolor: white;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ta:hover {\n\t\t\t\t\tbackground-color: darkblue;\n\t\t\t\t\tcolor: white;\n\t\t\t\t}\n\n\t\t\t\tp.footer {\n\t\t\t\t\tfont-size: .8rem;\n\t\t\t\t\tcolor: grey;\n\t\t\t\t}\n\t\t\t</style>\n\t\t</head>\n\t\t<body>\n\t\t\t<div class="main">\n\t\t\t<h1>\n\t\t\t\tThank you for registering for Collabs.io\n\t\t\t</h1>\n\t\t\t<hr>\n\t\t\t<p>\n\t\t\t\tHey,<br>\n\t\t\t\tI am the CEO of <b>Collabs.io</b>, and you have a great journey ahead with us.<br>\n\t\t\t\tYou can confirm your email by cliking the button below.\n\t\t\t</p>\n\t\t\t<a href="http:localhost:4000/auth/verify-email/${t}">\n\t\t\t\tConfirm your email\n\t\t\t</a>\n\t\t\t<p class="footer">\n\t\t\t\tCollabs.io\n\t\t\t</p>\n\t\t</div>\n\t\t</body>\n\t</html>\t\n    `}),t)},3607:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(3396)),u=r(n(8988));o(void 0,void 0,void 0,(function*(){yield i.default(),yield u.default()}))},5630:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(2127)),i=o(n(6069)),u=r.default.Router();u.use("/verify-email",i.default),t.default=u},6069:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(2127)),i=o(n(6524)),u=r.default.Router();u.use("/:token",i.default),t.default=u},6524:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(9722)),u=n(2275),s=n(3766);t.default=function(e,t,n){return o(this,void 0,void 0,(function*(){const{token:o}=e.params;try{const e=yield i.default.verify(o,u.TokenConfig.tokenSecret);yield s.User.findByIdAndUpdate(e.userId,{"accountInfo.verifiedEmail":!0}),t.send(`<h1>Your email ${e.email} is verified</h1>`),n()}catch(e){t.send("<h1>Token is expired</h1>"),n()}}))}},8479:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(2127)),i=o(n(5630)),u=r.default.Router();u.use("/auth",i.default),u.get("/",((e,t,n)=>{t.status(200).json({message:"Connected!"}),n()})),t.default=u},3928:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(5619)),i=o(n(8328)),u=o(n(5057)),s=n(2275),a=n(2275),d=i.default(u.default),c=r.default.createConnection(`mongodb+srv://${a.MongoConfig.mongoUserName}:${a.MongoConfig.mongoUserPassword}@cluster0.vuqtk.mongodb.net/${a.MongoConfig.mongoDatabaseName}?retryWrites=true&w=majority`,{useUnifiedTopology:!0,useNewUrlParser:!0});c.on("error",(function(e){console.log("[MONGOSTORE] Error connecting to MongoStore")}));const l=new d({mongooseConnection:c,collection:"sessions"});l.on("error",(function(e){console.log("[SERVER]  Error connecting to the mongodb store")}));const f=u.default({store:l,name:s.SessionConfig.sessionName,secret:s.SessionConfig.sessionSecret,rolling:!0,resave:!0,saveUninitialized:!1,cookie:{maxAge:parseInt(s.SessionConfig.sessionLifetime)}});t.default=f},8988:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8262),u=r(n(2127));console.log(process.env.PORT);const s=n(25),a=r(n(3180)),d=r(n(3928)),c=r(n(985)),l=r(n(8479));t.default=function(){return o(this,void 0,void 0,(function*(){const e=u.default();e.disable("x-powered-by"),e.use("/",l.default),e.use(d.default);const t=new i.ApolloServer({typeDefs:s.TypeDefs,resolvers:s.Resolvers,schemaDirectives:a.default,playground:{settings:{"request.credentials":"include"}},context:({req:e,res:t})=>o(this,void 0,void 0,(function*(){return{req:e,res:t,dataloaders:c.default}}))});t.applyMiddleware({app:e,cors:{credentials:!0,origin:"http://localhost:9000"}}),e.listen({port:process.env.PORT||4e3},(()=>{console.log("[SERVER] ready at http://localhost:4000"+t.graphqlPath)}))}))}},8262:e=>{e.exports=require("apollo-server-express")},6552:e=>{e.exports=require("bcrypt")},8328:e=>{e.exports=require("connect-mongo")},8712:e=>{e.exports=require("dataloader")},334:e=>{e.exports=require("dotenv")},2127:e=>{e.exports=require("express")},5057:e=>{e.exports=require("express-session")},9313:e=>{e.exports=require("graphql")},7772:e=>{e.exports=require("graphql/language")},9722:e=>{e.exports=require("jsonwebtoken")},5619:e=>{e.exports=require("mongoose")},8123:e=>{e.exports=require("nodemailer")},5439:e=>{e.exports=require("ramda")}},t={};!function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(3607)})();
//# sourceMappingURL=app.bundle.js.map